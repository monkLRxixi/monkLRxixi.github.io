import{_ as s,o as e,c as a,Q as l}from"./chunks/framework.gI2xCOxE.js";const k=JSON.parse('{"title":"WSL空间释放","description":"","frontmatter":{},"headers":[],"relativePath":"wsl/wsl-compact.md","filePath":"wsl/wsl-compact.md"}'),p={name:"wsl/wsl-compact.md"},o=l('<h1 id="wsl空间释放" tabindex="-1">WSL空间释放 <a class="header-anchor" href="#wsl空间释放" aria-label="Permalink to &quot;WSL空间释放&quot;">​</a></h1><p>解决删除文件后wsl2磁盘空间不释放的问题</p><p>在使用wsl的过程中，经常发现wsl2删除文件后虚拟磁盘空间不释放，非常奇怪，这里也是搜索了很多资料，最终找到解决办法，如下：</p><p>不同于 WSL1，WSL2 本质上是虚拟机，所以 Windows 会自动创建 vhdx 后缀的虚拟磁盘文件作为存储。</p><p>这个 vhdx 后缀的虚拟磁盘文件特点是可以<code>自动扩容</code>，但是一般<code>不会自动缩容</code>。</p><p>一旦有很多文件把它&quot;撑大&quot;，即使把这些文件删除它也不会自动&quot;缩小&quot;。所以删除文件后还需要我们手动进行压缩才能释放磁盘空间。</p><h2 id="解决办法" tabindex="-1">解决办法 <a class="header-anchor" href="#解决办法" aria-label="Permalink to &quot;解决办法&quot;">​</a></h2><ol><li><p><strong>找到并确定需要压缩的虚拟磁盘文件</strong></p><p>首先我们要找到ext4.vhdx文件，这个文件就是wsl2的虚拟磁盘文件，一般在C:\\Users\\用户名\\AppData\\Local\\Packages\\WSL2\\Files\\rootfs\\ext4.vhdx，这个文件就是wsl2的虚拟磁盘文件</p><blockquote><p>这里我的虚拟磁盘文件经过迁移，你们按照自己的来就好</p></blockquote><ul><li>ubuntu: O:\\WSL\\Ubuntu\\ext4.vhdx</li><li>docker desktop: O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\main\\ext4.vhdx</li><li>docker desktop data: O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\data\\ext4.vhdx</li></ul></li><li><p><strong>备份虚拟磁盘文件(可选)</strong></p><p>只是为了方便恢复，如果不需要可以忽略这一步</p></li><li><p><strong>压缩虚拟磁盘文件</strong></p><p><strong>首先关闭wsl</strong></p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">wsl </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">shutdown</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">wsl </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">shutdown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>允许管理计算机的驱动器的DiskPart命令:</strong></p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">diskpart</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">diskpart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>在打开的DiskPart命令窗口中，输入以下命令：</strong></p><ol><li><em>这里指定你需要压缩的虚拟磁盘文件</em></li></ol><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">select vdisk file</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;O:\\WSL\\Ubuntu\\ext4.vhdx&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">select vdisk file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;O:\\WSL\\Ubuntu\\ext4.vhdx&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">select vdisk file</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\main\\ext4.vhdx&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">select vdisk file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\main\\ext4.vhdx&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">select vdisk file</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\data\\ext4.vhdx&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">select vdisk file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;O:\\WSL\\docker-desktop-data\\DockerDesktopWSL\\data\\ext4.vhdx&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li><em>压缩文件</em>(<code>这里选择一个磁盘就需要压缩一次，不能同时选取多个磁盘文件</code>)</li></ol><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">compact vdisk</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">compact vdisk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li><em>压缩完毕后卸载磁盘</em></li></ol><p>如果报虚拟机磁盘服务错误;虚拟磁盘已经分离，不用担心，去看看磁盘大小即可</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">detach vdisk</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">detach vdisk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>执行完上述操作，wsl2删除后空出的磁盘空间就释放了</strong></p></li></ol>',8),t=[o];function n(i,c,r,d,h,u){return e(),a("div",null,t)}const b=s(p,[["render",n]]);export{k as __pageData,b as default};
